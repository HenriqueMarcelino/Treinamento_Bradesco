package br.com.stefanini.projetobd.persistence;

import java.sql.PreparedStatement;

import br.com.stefanini.projetoCorrentista.model.Usuario;

public class UsuarioDao extends Dao{

	public void createUsuario(Usuario usuario) throws Exception {
		
		open();

		stmt = con.prepareStatement("insert into usuario values(null,?,?)");
		stmt.setString(1, usuario.getNome());
		stmt.setString(2, usuario.getEmail());
		stmt.setInt(3, usuario.getIdUsuario());
		stmt.execute(); 
		stmt.close();

		close();

	}
	
	public Integer createUsuarioTransacaoReturn(Usuario usuario) throws Exception {

		open();

		con.setAutoCommit(false);
		int chave = 0;
		try {
			stmt = con.prepareStatement("insert into usuario values(null,?,?)",
					PreparedStatement.RETURN_GENERATED_KEYS);
			stmt.setString(1, usuario.getNome());
			stmt.setString(2, usuario.getEmail());
			stmt.setInt(3, usuario.getIdUsuario());
			stmt.executeUpdate();
			rs = stmt.getGeneratedKeys();
			rs.next(); // Para dar continuidade ao processo se não ele não retorna o resultado, o
						// comando esta pedindo para dar continuidade.

			chave = rs.getInt(1);
			stmt.close();

			stmt1 = con.prepareStatement("insert into endereco values(null,?,?,?)");
			stmt1.setString(1, u.getEndereco().getBairro());
			stmt1.setString(2, u.getEndereco().getCidade());
			stmt1.setInt(3, chave);
			stmt1.executeUpdate();
			stmt1.close();

			close();
			con.setAutoCommit(true);
			con.commit(); // Grava tudo
		} catch (Exception ex) {
			con.rollback();
			throw new Exception(ex.getMessage());
		} finally {
			con.close();
		}
		return chave;
	}

	
}
